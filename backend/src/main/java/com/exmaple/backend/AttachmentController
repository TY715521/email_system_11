@RestController
@RequestMapping("/api/attachments")
public class AttachmentController {

    @Autowired
    private AttachmentService attachmentService;

    // 上传附件（支持多文件）
    @PostMapping("/upload")
    public ResponseEntity<ApiResponse> uploadAttachment(
            @RequestParam("file") MultipartFile file,
            @RequestParam("mailId") Long mailId,
            @CurrentUser User user) {
        
        // 校验文件大小（例如 ≤10MB）
        if (file.getSize() > 10 * 1024 * 1024) {
            return ResponseEntity.badRequest().body(ApiResponse.error("文件大小不能超过10MB"));
        }

        // 校验文件类型（例如禁止.exe）
        String fileType = file.getContentType();
        if (fileType == null || fileType.equals("application/x-msdownload")) {
            return ResponseEntity.badRequest().body(ApiResponse.error("禁止上传可执行文件"));
        }

        // 调用服务层保存文件
        Attachment attachment = attachmentService.saveAttachment(file, mailId, user);
        return ResponseEntity.ok(ApiResponse.success("上传成功", attachment));
    }
}
